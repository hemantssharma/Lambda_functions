import boto3

def lambda_handler(event, context):
    rds = boto3.client('rds')
    try:
        instances = rds.describe_db_instances()['DBInstances']
        deleted = []
        for instance in instances:
            db_id = instance['DBInstanceIdentifier']
            tags = rds.list_tags_for_resource(
                ResourceName=instance['DBInstanceArn']
            )['TagList']
            tag_map = {t['Key']: t['Value'] for t in tags}
            if tag_map.get('Delete', '').lower() == 'yes':
                rds.delete_db_instance(
                    DBInstanceIdentifier=db_id,
                    SkipFinalSnapshot=True
                )
                deleted.append(db_id)
        return {
            'statusCode': 200,
            'deleted': deleted
        }
    except Exception as e:
        return {
            'statusCode': 500,
            'error': str(e)
        }
